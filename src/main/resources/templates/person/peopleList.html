<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link th:rel="stylesheet" th:href="@{/webjars/bootstrap/4.0.0-2/css/bootstrap.min.css} "/>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
            integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
    <link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
    <style>
        .record-hover:hover {
            box-shadow: 0 0 11px rgba(33,33,33,.2);
            background-color: darkgray;
        }
    </style>
</head>
<body>
<th:block th:replace="share/header :: header"></th:block>

<div class="container" th:fragment="content">
    <div>
        <h1 style="text-align: center; margin: 0">Manage Person Information</h1>
    </div>
    <hr>
    <span style="color: red; margin-top:5px" id="validate"></span>
    <br>
    <br>
    <div id="person-content">
    <table class="table">
        <div class="row">
        <form class="form-inline">
            <input class="form-control col-md-8 mr-sm-2" th:value="${key}" type="search" name="key" placeholder="Search by name, person id or phone number" aria-label="Search"><br><br>
            <div class="form-label-group col-md-8 md-form md-outline input-with-post-icon datepicker">
                <label class="text-secondary">Search by date of birth</label>
                <div class="form-group row">
                    <label class="col-sm-3 col-form-label">Start Date</label>
                    <div class="col-sm-9">
                        <input type="date" class="form-control datepicker" name="from" id="date-search-from" oninput="getFromDate()" max="" th:value="${from}">
                    </div>
                    <label class="col-sm-3 col-form-label">End Date</label>
                    <div class="col-sm-9">
                        <input type="date" class="form-control datepicker" id="date-search-to" max="" min="" th:value="${to}" name="to">
                    </div>
                </div>
<!--                <input type="date" id="date-search-from" oninput="getFromDate()" max="" th:value="${from}" class=" col-md-4 mr-sm-2 datepicker" name="from" >-->
<!--                <input type="date" id="date-search-to" max="" min="" th:value="${to}" class=" col-md-4 datepicker" name="to">-->
            </div>
            <br>
            <input type="submit" class="btn btn-danger col-md-8" value="search">
        </form>
        </div>
        <br>
        <thead>
        <th colspan="6">Person Information</th>
        <th></th>
        <th>
            <button type="button" id="add-person" class="btn btn-lg btn-success" >Add new person</button>
        </th>
        </thead>
        <thead>
        <tr>
            <th scope="col">#</th>
            <th scope="col">ID</th>
            <th scope="col">Name</th>
            <th scope="col">Gender</th>
            <th scope="col">Date of birth</th>
            <th scope="col">Classify</th>
            <th scope="col">Phone number</th>
            <th scope="col">Address</th>
<!--            <th colspan="2" scope="col">Action</th>-->
        </tr>
        </thead>
        <tbody>
        <tr class="record-hover" th:each ="person, s : ${persons}" th:onclick="'showDetail('+${person.id}+')'">
            <td th:utext="${s.index +1}"></td>
            <td th:utext="${person.code}"></td>
            <td th:utext="${person.name}"></td>
            <td th:utext="${person.gender==true}?'Male':'Female'"></td>
            <td th:utext="${person.dateOfBirth}"></td>
            <td th:utext="${person.classify.classify}"></td>
            <td th:utext="${person.phone}"></td>
            <td th:utext="${person.address}"></td>
        </tr>
        </tbody>
    </table>
    <div>
        <p th:if="${persons.content.size()<=0}">No Result, Incorrect information or not existed</p>
        <ul class="nav nav-pills" >
            <li class="nav-item" th:if="${persons.content.size()>0}" th:each="i:${#numbers.sequence(0,persons.totalPages-1)}">
                <a th:href="@{'/persons?key='+${key}+'&from='+${from}+'&to='+${to}(page=${i})}" th:text="${i+1}" class="nav-link" th:classappend="${persons.number}==${i}?'active':''"></a>
            </li>
        </ul>
    </div>
    </div>
</div>
<!-- show Modal -->
<div class="modal fade" id="showModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="showModalLabel">Add new person confirm</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="color: red">
                <div id="add-person-show-modal"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <a type="button" data-toggle="modal" data-target="#confirmModal" onclick="addNewPerson()" data-dismiss="modal" class="btn btn-primary" >Confirm</a>
            </div>
        </div>
    </div>
</div>

<!-- show edit Modal -->
<div class="modal fade" id="editPersonModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editPersonModalLabel">Update person confirm</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="color: red">
                <div id="edit-person-show-modal"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <a type="button" data-toggle="modal" data-target="#confirmModal" onclick="editPerson()" data-dismiss="modal" class="btn btn-primary" >Confirm</a>
            </div>
        </div>
    </div>
</div>

<!-- show delete Modal -->
<div class="modal fade" id="deletePersonModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deletePersonModalLabel">Delete person confirm</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="color: red">
                <div id="delete-person-show-modal"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <a type="button" data-toggle="modal" data-target="#confirmModal" onclick="deletePerson()" data-dismiss="modal" class="btn btn-primary" >Confirm</a>
            </div>
        </div>
    </div>
</div>

<!-- confirm Modal -->
<div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmModalLabel">Add new person confirm</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div id="confirm-content" class="modal-body" style="color: red">
                Add new success!
            </div>
            <div class="modal-footer">
                <button type="button" onclick="reload()" class="btn btn-secondary" data-dismiss="modal">Close</button>
<!--                <a type="button" class="btn btn-primary" data-dismiss="modal">Confirm</a>-->
            </div>
        </div>
    </div>
</div>

<th:block th:replace="share/footer :: footer"></th:block>



<script th:inline="javascript">
let checkPhoneInput;
let checkPersonName;
let checkPersonDob;
let today = new Date();
let year = today.getFullYear();
let month = today.getMonth()+1;
if (month<10){
    month = "0"+month
}
let day =today.getDate();
var maxDate = '' + year + '-' + month + '-' + day;

    function reload(){
        window.location.reload();
    }
let fromDate
function getFromDate(){
    fromDate = $('#date-search-from').val();
    $('.datepicker #date-search-to').attr("min", fromDate)
}
$(document).ready(function () {
    $('.datepicker #date-search-from').attr("max", maxDate)
    $('.datepicker #date-search-to').attr("min", [[${from}]])
    $('.datepicker #date-search-to').attr("max", maxDate)
    // show form add person
    $('#add-person').on('click', function (event) {
        $('#add-person-dob').attr("max", today)
        let str = '<div class="login d-flex align-items-center py-5">\n ' +
            ' <div class=container>\n' +
            '   <div class="row">\n' +
            '    <div class="col-md-9 col-lg-8 mx-auto pl-5 pr-5">\n' +
            '       <h3 class="login-heading mb-4">Add new person</h3>\n' +
            '<i style="color: black">Pls fill the form, have <i style="color: red">* </i>is required</i>' +
            '       <form id="form" method="post">\n' +
            '         <div class="form-label-group">\n' +
            '            <label for="add-person-name" class="text-secondary">Person name<i style="color: red">* </i></label>\n' +
            '<small style="color: red" id="check-add-person-name"></small>' +
            '           <input type="text" name="add-person-name" id="add-person-name" required class="form-control" >\n' +
            '          </div>\n' +
            '         <div class="form-label-group">\n' +
            '           <label for="add-person-gender" class="text-secondary">Gender<i style="color: red">* </i></label>\n' +
            '<small style="color: red" id="check-add-person-gender"></small>' +
            '<select id="add-person-gender" class="form-control">\n' +
            '   <option value="1">Male</option>\n' +
            '   <option value="0">Female</option>\n' +
            ' </select>' +
            '         </div>\n' +
            '          <div class="form-label-group mb-4 md-form md-outline input-with-post-icon datepicker">\n' +
            '            <label class="text-secondary">Date of birth<i style="color: red">* </i></label>\n' +
            '<small style="color: red" id="check-add-person-dob"></small>' +
            '            <input type="date" max="'+maxDate+'" name="add-person-dob" id="add-person-dob" required  class="form-control datepicker" >\n' +
            '          </div>\n' +
            '          <div class="form-label-group mb-4">\n' +
            '            <label class="text-secondary">Phone number<i style="color: red">* </i></label>\n' +
            '<small style="color: red" id="check-add-person-phone"></small>' +
            '            <input oninput="checkPhone()" type="number" id="add-person-phone" class="form-control" required>\n' +
            '<p></p>' +
            '          </div>\n' +
            '          <div class="form-label-group mb-4">\n ' +
            '           <label class="text-secondary">Classify<i style="color: red">* </i></label>' +
            '<select id="add-person-classify" class="form-control">';
        var link = 'http://localhost:8080/classifies';
        $.get(link, function (classify, status) {
            let classifyList = classify.slice();
            let html;
            $.each(classifyList, function (index, items) {
                html += '<option value="' + items.id + '">' + items.classify + '</option>'
            })
            $('#add-person-classify').append(html);
        })
        str += ' </select>' +
            '       </div>\n' +
            '        <div class="form-label-group mb-4">\n' +
            '           <label class="text-secondary">Address</label>\n' +
            '           <textarea  type="text" id="add-person-address" class="form-control"></textarea>\n' +
            '         </div>\n' +
            '          <div class="form-label-group mb-4">\n' +
            '         </div>\n' +
            '         <a data-toggle="modal" id="function-btn" data-target="#showModal" onclick="checkInput()" class="btn btn-lg btn-outline-primary btn-block btn-login text-uppercase font-weight-bold mb-2">Add new</a>\n' +
            '         <a onclick="reload()" class="btn btn-lg btn-outline-primary btn-block btn-login text-uppercase font-weight-bold mb-2">Back</a>\n' +
            '       </form>\n' +
            '     </div>\n' +
            '   </div>\n' +
            '  </div>\n' +
            '</div>'

        $('#person-content').html(str);
    })
})


function checkPhone(){
        let id = $('#add-person-id').val();
        let phone = $('#add-person-phone').val();
        if (phone==""){
            $('#check-add-person-phone').html("Phone number cannot blank")
            checkPhoneInput = false
            return;
        }else
        if (!phone.match("(0[3|5|7|8|9])+([0-9]{8})\\b")){
            checkPhoneInput = false
            $('#check-add-person-phone').html("Phone number not correct format, phone contains 10 numbers begin with 0")
            return
        }else
    if (id){
        $.ajax({
            async: false,
            url: "http://localhost:8080/persons/"+id,
            type: 'GET',
            success: function (data) {
               if (data.phone==phone){
                   checkPhoneInput = true;
               }else {
                   $.ajax({
                       async: false,
                       url: "http://localhost:8080/persons/phone/"+phone,
                       type: 'GET',
                       success: function (data) {
                            if (data=="existed"){
                               checkPhoneInput = false
                               $('#check-add-person-phone').html("Phone number existed,Pls try again")
                               return;
                           }
                           else {
                               $('#check-add-person-phone').html("")
                               checkPhoneInput = true
                               return;
                           }
                       }
                   })
               }
            }
        })
    }else {
        $.ajax({
            async: false,
            url: "http://localhost:8080/persons/phone/"+phone,
            type: 'GET',
            success: function (data) {
                 if (data=="existed"){
                    checkPhoneInput = false
                    $('#check-add-person-phone').html("Phone number existed,Pls try again")
                    return;
                }
                else {
                    $('#check-add-person-phone').html("")
                    checkPhoneInput = true
                    return;
                }
            }
        })
    }
}

function checkNameInput(){
            let name = $('#add-person-name').val();
            if (name==""){
                $('#check-add-person-name').html("Name cannot blank")
                checkPersonName = false;
                return
            }else
            if (!name.match("^([a-zA-Zỳọáầảấờễàạằệếýộậốũứĩõúữịỗìềểẩớặòùồợãụủíỹắẫựỉỏừỷởóéửỵẳẹèẽổẵẻỡơôưăêâđ]+)((\\s{1}[a-zA-Zỳọáầảấờễàạằệếýộậốũứĩõúữịỗìềểẩớặòùồợãụủíỹắẫựỉỏừỷởóéửỵẳẹèẽổẵẻỡơôưăêâđ]+){1,})$")){
                $('#check-add-person-name').html("Name least 2 word with space seperate, without special character or number")
                checkPersonName = false;
                return;
            }else {
                $('#check-add-person-name').html("")
                checkPersonName = true;
                return;
            }
}

function checkDob(){
    let dob = $('#add-person-dob').val();
    if (dob==""){
        $('#check-add-person-dob').html("Date of birth cannot blank")
        checkPersonDob = false;
        return
    } else
    if (dob.match("^(0?[1-9]|[12][0-9]|3[01])[\\/\\-](0?[1-9]|1[012])[\\/\\-]\\d{4}$")){
        $('#check-add-person-dob').html("date incorrect format")
        checkPersonDob = false;
        return
    }
    else {
        $('#check-add-person-dob').html("")
        checkPersonDob = true;
        return
    }
}

function checkInput(){
   checkNameInput()
   checkPhone()
    checkDob()
    let id = $('#add-person-id').val();
    console.log("check", checkPhoneInput, checkPersonName, checkPersonDob)
    if (checkPhoneInput&&checkPersonName&&checkPersonDob){
        if (id){
            $('#function-btn').attr("data-toggle","modal");
            $('#function-btn').attr("data-target","#editPersonModal");
            getEditPersonInfo();
        }else {
            $('#function-btn').attr("data-toggle","modal");
            $('#function-btn').attr("data-target","#showModal");
            getNewPersonInfo();
        }
    }else {
        $('#function-btn').attr("data-target","");
        $('#function-btn').attr("data-toggle","");
        checkNameInput()
        checkPhone()
        checkDob()
    }
}

    // show detail person form
    function showDetail(id){
        let str = "";
            $.ajax({
                async: false,
                url: 'http://localhost:8080/persons/'+id,
                method: 'GET',
                dataType: 'json',
                success: function (data) {
                    // console.log(data)
                    str +='<div class="d-flex align-items-center py-5" >\n '+
                        '  <div class="container">\n' +
                        '    <div class="row">\n' +
                        '      <div class="col-md-9 col-lg-8 mx-auto pl-5 pr-5">\n' +
                        '<div class="row no-gutters">\n' +
                        '            <input type="text" disabled value="'+data.id+'" hidden id="add-person-id" class="form-control" >\n' +
                        '  <div class="col-12 col-sm-6 col-md-10"><h3 class=" mb-4" >Person Information</h3></div>\n' +
                        '  <div class="col-6 col-md-2"><a type="button" class="btn btn-primary" style="margin-inline-end: auto; text-align: right" data-toggle="" data-target="" id="showEdit" onclick="showEditForm()">Edit</a></div>\n' +
                        '</div>'+
                        '        <form>\n' +
                        '          <div class="form-label-group">\n' +
                        '            <label class="text-secondary">Person ID</label>\n' +
                        '            <input type="text" disabled value="'+data.code+'" id="add-person-code" class="form-control" >\n' +
                        '          </div>\n' +
                        '          <div class="form-label-group">\n' +
                        '            <label class="text-secondary">Person name</label>\n' +
                        '<small style="color: red" id="check-add-person-name"></small>'+
                        '            <input type="text" disabled value="'+data.name+'" id="add-person-name" class="form-control" >\n' +
                        '          </div>\n' +
                        '          <div class="form-label-group">\n' +
                        '            <label class="text-secondary">Gender</label>\n' +
                        '<small style="color: red" id="check-add-person-gender"></small>'+
                        '<select disabled id="add-person-gender" class="form-control">\n'
                    if (data.gender){
                        str +='   <option selected value="1">Male</option>\n' +
                            '   <option value="0">Female</option>\n'
                    }else {
                        str +='   <option  value="1">Male</option>\n' +
                            '   <option selected value="0">Female</option>\n'
                    }
                       str += ' </select>'+
                        '          <div class="form-label-group mb-4 md-form md-outline input-with-post-icon datepicker">\n' +
                        '            <label class="text-secondary">Date of birth</label>\n' +
                           '<small style="color: red" id="check-add-person-dob"></small>'+
                           '            <input disabled type="date" max="'+maxDate+'" oninput="checkDobInput()" id="add-person-dob" value="'+data.dateOfBirth+'" class="form-control">\n' +
                    '          </div>\n' +
                        '          <div class="form-label-group mb-4">\n' +
                        '            <label class="text-secondary">Phone number</label>\n' +
                           '<small style="color: red" id="check-add-person-phone"></small>'+
                           '            <input disabled oninput="checkPhone()" type="number" value="'+data.phone+'" id="add-person-phone" class="form-control" required pattern="0((\\\\(\\\\d{3}\\\\))|\\\\d{3})?\\\\d{3}?\\\\d{4}$\">\n' +
                        '<p></p>'+
                        '          </div>\n' +
                        '          <div class="form-label-group mb-4">\n '+
                        '           <label class="text-secondary">Classify</label> <br>\n'+
                        '<select disabled id="add-person-classify" class="form-control">';
                    var link = 'http://localhost:8080/classifies';
                    $.get(link,function (classify, status){
                        let classifyList = classify.slice();
                        let html;
                        $.each(classifyList, function (index, items){
                            // console.log("items laa ra", items.id)
                            if (items.classify == data.classify.classify){
                                html +='<option selected value="'+items.id+'">'+items.classify+'</option>'
                            }else {
                                html +='<option value="'+items.id+'">'+items.classify+'</option>'
                            }
                        })
                        $('#add-person-classify').append(html);
                    })
                    str +=  ' </select>'+
                        '       </div>\n' +
                        '        <div class="form-label-group mb-4">\n' +
                        '           <label class="text-secondary">Address</label>\n' +
                        // '           <input disabled type="text" value="'+data.address+'" id="add-person-address"  class="form-control">\n' +
                        '<textarea disabled type="text" id="add-person-address" value="'+data.address+'" class="form-control"></textarea>'+
                        '         </div>\n' +
                        '          <div class="form-label-group mb-4">\n' +
                        '         </div>\n' +
                        '         <a data-toggle="modal" id="function-btn" onclick="getDeletePersonInfo()" data-target="#deletePersonModal" class="btn btn-lg btn-outline-primary btn-block btn-login text-uppercase font-weight-bold mb-2">Delete</a>\n' +
                    '        <a onclick="reload()" class="btn btn-lg btn-outline-primary btn-block btn-login text-uppercase font-weight-bold mb-2">Back</a>\n' +
                    '       </form>\n' +
                        '      </div>\n' +
                        '    </div>\n' +
                        '    </div>\n' +
                        '</div>';
                    $('#person-content').html(str);
                }
            })
        }

    // get person info
    function getNewPersonInfo(){
        let name = $('#add-person-name').val();
        let genderId = $('#add-person-gender').val();
        console.log(genderId, "gender")
        let gender;
        if (genderId==1){
            gender = "Male";
        }else {
            gender = "Female"
        }
        let classifyId = $('#add-person-classify').val();
        let classify;
        let dob = $('#add-person-dob').val();
        let phone = $('#add-person-phone').val();
        let address = $('#add-person-address').val();
        let str = "";
        str+= '<table class="table">\n' +
            '    <tr>\n' +
            '        <td>Name:</td>\n' +
            '        <td>'+name+'</td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>Gender:</td>\n' +
            '        <td>'+gender+'</td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>Date of birth:</td>\n' +
            '        <td>'+dob+'</td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>Phone:</td>\n' +
            '        <td>'+phone+'</td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>Address:</td>\n' +
            '        <td>'+address+'</td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>Classify:</td>\n'
        let href = "http://localhost:8080/classifies/"+classifyId;
        $.ajax({
            async: false,
            url: href,
            type: 'GET',
            success: function (data) {
                str+=    '<td>'+data.classify+'</td>\n'
            }
        })
         str +=   '</tr></table>\n'
        $('#add-person-show-modal').html(str)
    }
// get edit person info
function getEditPersonInfo(){
        let id = $('#add-person-id').val();
    let name = $('#add-person-name').val();
    let code = $('#add-person-code').val();
    let genderId = $('#add-person-gender').val();
    let gender;
    if (genderId==1){
        gender = "Male";
    }else {
        gender = "Female"
    }
    let classifyId = $('#add-person-classify').val();
    let classify;
    let dob = $('#add-person-dob').val();
    let phone = $('#add-person-phone').val();
    let address = $('#add-person-address').val();
    let str = "";

    str+= '<table class="table">\n' +
        '    <tr>\n' +
        '        <td>Name:</td>\n' +
        '        <td>'+name+'</td>\n' +
        '    </tr>\n' +
        '    <tr>\n' +
        '        <td>Gender:</td>\n' +
        '        <td>'+gender+'</td>\n' +
        '    </tr>\n' +
        '    <tr>\n' +
        '        <td>Date of birth:</td>\n' +
        '        <td>'+dob+'</td>\n' +
        '    </tr>\n' +
        '    <tr>\n' +
        '        <td>Phone:</td>\n' +
        '        <td>'+phone+'</td>\n' +
        '    </tr>\n' +
        '    <tr>\n' +
        '        <td>Address:</td>\n' +
        '        <td>'+address+'</td>\n' +
        '    </tr>\n' +
        '    <tr>\n' +
        '        <td>Classify:</td>\n'
    let href = "http://localhost:8080/classifies/"+classifyId;
    $.ajax({
        async: false,
        url: href,
        type: 'GET',
        success: function (data) {
            str+=    '<td>'+data.classify+'</td>\n'
        }
    })
    str +=   '</tr></table>\n'
    $('#edit-person-show-modal').html(str)
}
//get delet person info
function getDeletePersonInfo(){
    let id = $('#add-person-id').val();
    $.ajax({
        async: false,
        url:"http://localhost:8080/orders/person/" +id,
        type: 'GET',
        success: function (data) {
            console.log(data)
            if (data=="existed"){
                $('#function-btn').attr("data-target","#confirmModal");
                $('#function-btn').attr("data-toggle","modal");
                $('#confirmModalLabel').html("Action error")
                $('#confirm-content').html("Person's in borrowing, can't delete")
            }else {
    let name = $('#add-person-name').val();
    let code = $('#add-person-code').val();
    let genderId = $('#add-person-gender').val();
    let gender;
    if (genderId==1){
        gender = "Male";
    }else {
        gender = "Female"
    }
    let classifyId = $('#add-person-classify').val();
    let classify;
    let dob = $('#add-person-dob').val();
    let phone = $('#add-person-phone').val();
    let address = $('#add-person-address').val();
    let str = "";
                str+= '<table class="table">\n' +
                    '    <tr>\n' +
                    '        <td>Name:</td>\n' +
                    '        <td>'+name+'</td>\n' +
                    '    </tr>\n' +
                    '    <tr>\n' +
                    '        <td>Gender:</td>\n' +
                    '        <td>'+gender+'</td>\n' +
                    '    </tr>\n' +
                    '    <tr>\n' +
                    '        <td>Date of birth:</td>\n' +
                    '        <td>'+dob+'</td>\n' +
                    '    </tr>\n' +
                    '    <tr>\n' +
                    '        <td>Phone:</td>\n' +
                    '        <td>'+phone+'</td>\n' +
                    '    </tr>\n' +
                    '    <tr>\n' +
                    '        <td>Address:</td>\n' +
                    '        <td>'+address+'</td>\n' +
                    '    </tr>\n' +
                    '    <tr>\n' +
                    '        <td>Classify:</td>\n'
                let href = "http://localhost:8080/classifies/"+classifyId;
                $.ajax({
                    async: false,
                    url: href,
                    type: 'GET',
                    success: function (data) {
                        str+=    '<td>'+data.classify+'</td>\n'
                    }
                })
                str +=   '</tr></table>\n'
    $('#delete-person-show-modal').html(str)
            }
        }
    })
}

    // show edit form
    function showEditForm(){
        let id = $('#add-person-id').val();
        $.ajax({
            async: false,
            url: "http://localhost:8080/orders/person-borrow/" + id,
            type: 'GET',
            success: function (data) {
                if (data == "existed") {
                    $('#confirmModalLabel').html("Action error")
                    $('#confirm-content').html("Person's in borrowing, can't edit")
                    $('#showEdit').attr("data-toggle","modal");
                    $('#showEdit').attr("data-target","#confirmModal");
                } else {
      $('#add-person-name').attr("disabled", false);
        $('#add-person-gender').attr("disabled", false);
       $('#add-person-classify').attr("disabled", false);
        $('#add-person-dob').attr("disabled", false);
        $('#add-person-phone').attr("disabled", false);
       $('#add-person-address').attr("disabled", false);
       $('#function-btn').html("Update");
       $('#function-btn').attr("data-target","#editPersonModal");
       $('#function-btn').attr("onclick","checkInput()");
                }
            }
        })
    }

// create new person
    function addNewPerson(){
        let name = $('#add-person-name').val();
        let genderId = $('#add-person-gender').val();
        // let gender;
        // if (genderId==1){
        //     gender = true
        // }else {
        //     gender = false
        // }
        let classifyId = $('#add-person-classify').val();
        let dob = $('#add-person-dob').val();
        let phone = $('#add-person-phone').val();
        let address = $('#add-person-address').val();
        let obj = {
            "name": name,
            // "gender": gender,
            "gender": genderId,
            "address":address,
            "phone": phone,
            "dateOfBirth": dob,
            "avatar":"",
            "classify": {
                "id": classifyId
            }
        }
        let data = JSON.stringify(obj)
        $.ajax({
            async: false,
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            url: "http://localhost:8080/persons",
            type: 'POST',
            data: data,
            success: function (data) {
                console.log("data", data)
            },
            error: function (data){
                console.log("error", data)
                $('#confirmModalLabel').html("Add new person confirm");
                $('#confirm-content').html("Add unsuccess because "+data.responseText+"! please check again");
            }
        })
    }
// create new person
function editPerson(){
    let id = $('#add-person-id').val();
    let name = $('#add-person-name').val();
    let genderId = $('#add-person-gender').val();
    // let gender;
    // if (genderId==1){
    //     gender = true
    // }else {
    //     gender = false
    // }
    let classifyId = $('#add-person-classify').val();
    let dob = $('#add-person-dob').val();
    let phone = $('#add-person-phone').val();
    let address = $('#add-person-address').val();
    let obj = {
        "name": name,
        // "gender": gender,
        "gender": genderId,
        "address":address,
        "phone": phone,
        "dateOfBirth": dob,
        "avatar":null,
        "classify": {
            "id": classifyId
        }
    }
    let data = JSON.stringify(obj)
    $.ajax({
        async: false,
        headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
        },
        url: "http://localhost:8080/persons?id="+id,
        type: 'PUT',
        data: data,
        success: function (data) {
            $('#confirmModalLabel').html("Update person confirm");
            $('#confirm-content').html("Update success!");
        },
        error:function (data){
            console.log("error", data)
            $('#confirmModalLabel').html("Update person confirm");
            $('#confirm-content').html("Update unsuccess because "+data.responseText+"! please check again");
        }
    })
}
// create new person
function deletePerson(){
    let id = $('#add-person-id').val();
    $.ajax({
        async: false,
        headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
        },
        url: "http://localhost:8080/persons/"+id,
        type: 'PUT',
        success: function (data) {
            $('#confirmModalLabel').html("Delete person confirm");
            $('#confirm-content').html("Delete success!");
        },
        error: function (data){
            console.log("error", data)
            $('#confirmModalLabel').html("Delete person confirm");
            $('#confirm-content').html("Delete unsuccess because "+data.responseText+"! please check again");
        }
    })
}

</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js" type="text/javascript"></script>
<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="Stylesheet" type="text/css" />
<script th:src="@{/webjars/jquery/jquery.min.js}"></script>
<script th:src="@{/webjars/popper.js/umd/popper.min.js}"></script>
<script th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"></script>

</body>
</html>