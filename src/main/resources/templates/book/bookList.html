<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link th:rel="stylesheet" th:href="@{/webjars/bootstrap/4.0.0-2/css/bootstrap.min.css} "/>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
            integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
    <link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
    <style>
        .record-hover:hover {
            box-shadow: 0 0 11px rgba(33,33,33,.2);
            background-color: darkgray;
        }
    </style>
</head>
<body>
<th:block th:replace="share/header :: header"></th:block>
<div class="container" th:fragment="content">
    <div>
        <h1 style="text-align: center; margin: 0">Manage Book Information</h1>
    </div>
    <hr>
    <span style="color: red; margin-top:5px" id="validate"></span>
    <br>
    <br>
    <div id="book-content">
        <table class="table">
            <div class="row">
                <form class="form-inline">
                    <input class="form-control col-md-8 mr-sm-2" th:value="${key}" type="search" name="key"
                           placeholder="Search by name, person id or phone number" aria-label="Search"><br><br>
                    <div class="form-label-group col-md-8 md-form md-outline input-with-post-icon">
                        <label class="text-secondary">Search by book category</label>
                        <div class="form-group row">
                            <label class="col-sm-3 col-form-label">Chose category</label>
                            <div class="col-sm-9">
                                <select style="width: 100%" class="form-control" name="category_id">
                                    <option value="0">category quick search</option>
                                    <option th:each="b: ${categories}" th:value="${b.id}"
                                            th:selected="${category_id}==${b.id}?'selected':'false'"
                                            th:utext="${b.category}"></option>
                                </select>
                            </div>
                        </div>
                        <!--                <input type="date" id="date-search-from" oninput="getFromDate()" max="" th:value="${from}" class=" col-md-4 mr-sm-2 datepicker" name="from" >-->
                        <!--                <input type="date" id="date-search-to" max="" min="" th:value="${to}" class=" col-md-4 datepicker" name="to">-->
                    </div>
                    <br>
                    <!--                <input class="form-control col-md-8 mr-sm-2" type="search" th:value="${key}" name="key"-->
                    <!--                       placeholder="Search by name or book code" aria-label="Search">-->
<!--                                    <select style="width: 100%" class="form-control col-md-8" name="category_id">-->
<!--                                        <option value="0">category quick search</option>-->
<!--                                        <option th:each="b: ${categories}" th:value="${b.id}"-->
<!--                                                th:selected="${category_id}==${b.id}?'selected':'false'"-->
<!--                                                th:utext="${b.category}"></option>-->
<!--                                    </select>-->
                    <br>
                    <input class="form-control col-md-8 btn btn-danger" type="submit" value="search">
                </form>
            </div>
            <br>
            <thead>
            <th colspan="5">Book Information</th>
            <th>
                <button type="button" id="add-book"  data-toggle="modal" data-target="#addBookModal" onclick="addNewBookForm()" class="btn btn-lg btn-success">Add new book</button>
            </th>
            </thead>
            <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Code</th>
                <th scope="col">Name</th>
                <th scope="col">Author</th>
                <th scope="col">Category</th>
                <th scope="col">Quantity</th>
                <th colspan="2" scope="col">Action</th>
            </tr>
            </thead>
            <tbody>
            <tr class="record-hover" th:each="b, s : ${books}" th:onclick="'showDetail('+${b.id}+')'">
                <td th:utext="${s.index +1}"></td>
                <td th:utext="${b.code}"></td>
                <td th:utext="${b.name}"></td>
                <td th:utext="${b.author}"></td>
                <td th:utext="${b.category.category}"></td>
                <td th:utext="${b.inStock}"></td>
                <td><a data-toggle="modal" data-target="#viewBookModal" th:onclick="'showDetail('+${b.id}+')'"  class="btn btn-primary">View/Edit</a></td>
                <td><a data-toggle="modal" data-target="#deletebookModal" th:onclick="'getDeletebookInfo('+${b.id}+')'"  class="btn btn-danger">Delete</a></td>
                <!--            <td><a th:href="@{/books/findById/(id=${book.id})}" class="btn btn-danger" id="deleteButton">Delete</a></td>-->
            </tr>
            </tbody>
        </table>
        <div>
            <p th:if="${books.content.size()<=0}">No Result, Incorrect information or not existed</p>
            <ul class="nav nav-pills">
                <li class="nav-item" th:if="${books.content.size()>0}"
                    th:each="i:${#numbers.sequence(0,books.totalPages-1)}">
                    <a th:href="@{'/books?key='+${key}+'&category_id='+${category_id}(page=${i})}" th:text="${i+1}"
                       class="nav-link" th:classappend="${books.number}==${i}?'active':''"></a>
                </li>
            </ul>
        </div>
    </div>
</div>

<!-- add Modal -->
<div class="modal fade" id="addBookModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addBookModalLabel">Add new book form</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div id="add-book-add-modal"></div>
        </div>
    </div>
</div>
<!-- show Modal -->
<div class="modal fade" id="showBookModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="showBookModalLabel">Add new book confirm</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="color: red">
                <div id="add-book-show-modal"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <a type="button" data-toggle="modal" data-target="#confirmModal" onclick="addNewBook()"
                   data-dismiss="modal" class="btn btn-primary">Confirm</a>
            </div>
        </div>
    </div>
</div>

<!-- view Modal -->
<div class="modal fade" id="viewBookModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewBookModalLabel"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div id="add-book-view-modal"></div>
        </div>
    </div>
</div>


<!-- show edit Modal -->
<div class="modal fade" id="editbookModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editbookModalLabel">Update book confirm</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="color: red">
                <div id="edit-book-show-modal"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <a type="button" data-toggle="modal" data-target="#confirmModal" onclick="editBook()"
                   data-dismiss="modal" class="btn btn-primary">Confirm</a>
            </div>
        </div>
    </div>
</div>

<!-- show delete Modal -->
<div class="modal fade" id="deletebookModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deletebookModalLabel">Delete book confirm</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="color: red">
                <div id="delete-book-show-modal"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <a type="button" id="delete-book-cf-btn" data-toggle="modal" data-target="#confirmModal" onclick="deletebook()"
                   data-dismiss="modal" class="btn btn-primary">Confirm</a>
            </div>
        </div>
    </div>
</div>

<!-- confirm Modal -->
<div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmModalLabel">Add new book confirm</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div id="confirm-content" class="modal-body" style="color: red">
                Add new success!
            </div>
            <div class="modal-footer">
                <button type="button" onclick="reload()" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <!--                <a type="button" class="btn btn-primary" data-dismiss="modal">Confirm</a>-->
            </div>
        </div>
    </div>
</div>


<th:block th:replace="share/footer :: footer"></th:block>


<script th:inline="javascript">
    let id_action;
    let checkBookCode;
    let checkBookName;
    let checkBookInStock;
    let checkBookAuthor;

    function reload() {
        window.location.reload();
        document.getElementsByName("category_id").selected = false;
    }

    $(document).ready(function () {   })
        //show form add book
    function addNewBookForm() {
        // $('#add-book').on('click', function (event) {
            let str = "";
            // event.preventDefault();
            str += '<div class="login d-flex align-items-center py-5">\n ' +
                ' <div class=container>\n' +
                '   <div class="row">\n' +
                '    <div class="col-md-9 col-lg-8 mx-auto pl-5 pr-5">\n' +
                '       <h3 class="login-heading mb-4">Add new book</h3>\n' +
                '<i style="color: black">Pls fill the form, have <i style="color: red">* </i>is required</i>' +
                '       <form id="form" method="post">\n' +
                '         <div class="form-label-group">\n' +
                '            <label for="add-book-code" class="text-secondary">Book code<i style="color: red">* </i></label>' +
                '<small style="color: red" id="check-add-book-code"></small>' +
                '<br>\n' +
                '<small >suggest: you can make name with structure: "book category code + barcode", eg: NOV032654785</small>' +
                '           <input type="text" name="add-book-code" id="add-book-code" required class="form-control" >\n' +
                '          </div>\n' +
                '         <div class="form-label-group">\n' +
                '            <label for="add-book-name" class="text-secondary">Book name<i style="color: red">* </i></label>\n' +
                '<small style="color: red" id="check-add-book-name"></small>' +
                '           <input type="text" name="add-book-name" id="add-book-name" required class="form-control" >\n' +
                '          </div>\n' +
                '         <div class="form-label-group">\n' +
                '            <label for="add-book-author" class="text-secondary">Book Author<i style="color: red">* </i></label>\n' +
                '<small style="color: red" id="check-add-book-author"></small>' +
                '           <input type="text" name="add-book-author" id="add-book-author" required class="form-control" >\n' +
                '          </div>\n' +
                '          <div class="form-label-group mb-4">\n ' +
                '           <label class="text-secondary">Category<i style="color: red">* </i></label> <br>\n' +
                '<select id="add-book-category" class="form-control">';
            $.ajax({
                async: false,
                url: "http://localhost:8080/categories",
                type: 'GET',
                success: function (data) {
                    let categories = data.slice();
                    $.each(categories, function (index, items) {
                        // console.log("items laa ra", items.id)
                        str += '<option value="' + items.id + '">' + items.code + '-' + items.category + '</option>'
                    })
                }
            })
            str += ' </select>' +
                '         <div class="form-label-group">\n' +
                '            <label for="add-book-inStock" class="text-secondary">Quantity</label>\n' +
                '<small style="color: red" id="check-add-book-inStock"></small>' +
                '           <input type="number" name="add-book-inStock" id="add-book-inStock" required class="form-control" >\n' +
                '          </div>\n' +
                '<br><br>' +
                '         <a data-toggle="modal" id="function-btn-book" data-target="#showBookModal" onclick="checkBookInput()" class="btn btn-lg btn-outline-primary btn-block btn-login text-uppercase font-weight-bold mb-2">Add new</a>\n' +
                '         <a onclick="reload()" class="btn btn-lg btn-outline-primary btn-block btn-login text-uppercase font-weight-bold mb-2">Back</a>\n' +
                '       </form>\n' +
                '     </div>\n' +
                '   </div>\n' +
                '  </div>\n' +
                '</div>'
            $('#add-book-add-modal').html(str);
    }


    // show detail book form
    function showDetail(id) {
        $.ajax({
            async: false,
            url: 'http://localhost:8080/books/' + id,
            method: 'GET',
            dataType: 'json',
            success: function (data) {
                // console.log(data)
                let str = "";
                str +=
                    '  <div class="container">\n' +
                    '    <div class="row">\n' +
                    '      <div class="col-md-9 col-lg-8 mx-auto pl-5 pr-5">\n' +
                    '            <input type="text" disabled value="' + data.id + '" hidden id="add-book-id" class="form-control" >\n' +
                    '<div class="row no-gutters">\n' +
                    '  <div class="col-12 col-sm-6 col-md-10"><h3 class="login-heading mb-4">Book Information</h3></div>\n' +
                    '  <div class="col-6 col-md-2"></div>\n' +
                    '</div>' +
                    '        <form>\n' +
                    '          <div class="form-label-group">\n' +
                    '            <label class="text-secondary">Book code</label>\n' +
                    '<small style="color: red" id="check-add-book-code"></small>' +
                    '            <input type="text" disabled value="' + data.code + '" id="add-book-code" class="form-control" >\n' +
                    '          </div>\n' +
                    '          <div class="form-label-group">\n' +
                    '            <label class="text-secondary">Book name</label>\n' +
                    '<small style="color: red" id="check-add-book-name"></small>' +
                    '            <input type="text" disabled value="' + data.name + '" id="add-book-name" class="form-control" >\n' +
                    '          </div>\n' +
                    '          <div class="form-label-group mb-4 md-form md-outline input-with-post-icon datepicker">\n' +
                    '            <label class="text-secondary">Author</label>\n' +
                    '<small style="color: red" id="check-add-book-author"></small>' +
                    '            <input disabled type="text" id="add-book-author" value="' + data.author + '" class="form-control">\n' +
                    '          </div>\n' +
                    '          <div class="form-label-group mb-4">\n ' +
                    '           <label class="text-secondary">Category</label> <br>\n' +
                    '<select disabled id="add-book-category" class="form-control">';
                var link = 'http://localhost:8080/categories';
                $.get(link, function (category, status) {
                    let categoryList = category.slice();
                    let html = "";
                    $.each(categoryList, function (index, items) {
                        // console.log("items laa ra", items.id)
                        if (items.category == data.category.category) {
                            html += '<option selected value="' + items.id + '">' + items.code + '-' + items.category + '</option>'
                        } else {
                            html += '<option value="' + items.id + '">' + items.code + '-' + items.category + '</option>'
                        }
                    })
                    $('#add-book-category').append(html);
                })
                str += ' </select>' +
                    '       </div>\n' +
                    '          <div class="form-label-group mb-4">\n' +
                    '         </div>\n' +
                    '          <div class="form-label-group mb-4 md-form md-outline input-with-post-icon datepicker">\n' +
                    '            <label class="text-secondary">Quantity</label>\n' +
                    '<small style="color: red" id="check-add-book-inStock"></small>' +
                    '            <input disabled type="number" id="add-book-inStock" value="' + data.inStock + '" class="form-control">\n' +
                    '          </div>\n' +
                    '         <a id="function-btn-book" data-toggle="" data-target="" onclick="showEditForm(' + data.id + ')" class="btn btn-lg btn-outline-primary btn-block btn-login text-uppercase font-weight-bold mb-2">Edit</a>\n' +
                    '        <button type="button" class="btn btn-lg btn-outline-primary btn-block btn-login text-uppercase font-weight-bold mb-2" data-dismiss="modal">Close</button>\n' +
                    '       </form>\n' +
                    '      </div>\n' +
                    '    </div>\n' +
                    '</div>';
                $('#add-book-view-modal').html(str);
            }
        })
    }

    function checkName() {
        let name = $('#add-book-name').val();
        let id = $('#add-book-id').val();
        if (name == "") {
            console.log("check name")
            $('#check-add-book-name').html("Name cannot blank")
            checkBookName = false
            return;
        }else
        if (!name.match("^([a-zA-Z0-9'.#*+-ỳọáầảấờễàạằệếýộậốũứĩõúữịỗìềểẩớặòùồợãụủíỹắẫựỉỏừỷởóéửỵẳẹèẽổẵẻỡơôưăêâđ\\s]+)$")) {
            $('#check-add-book-name').html("Name without special character")
            checkBookName = false;
            return;
        }else
        if (id) {
            $.ajax({
                async: false,
                url: "http://localhost:8080/books/" + id,
                type: 'GET',
                success: function (data) {
                    if (data.name == name) {
                        checkBookName = true
                        return
                    } else {
                        $.ajax({
                            async: false,
                            url: "http://localhost:8080/books/name/" + name,
                            type: 'GET',
                            success: function (data) {
                                if (data == "existed") {
                                    $('#check-add-book-name').html("Book name existed,Pls try again")
                                    checkBookName = false
                                    return
                                } else {
                                    $('#check-add-book-name').html("")
                                    checkBookName = true
                                    return;
                                }
                            }
                        })
                    }
                }
            })
        } else {
            $.ajax({
                async: false,
                url: "http://localhost:8080/books/name/" + name,
                type: 'GET',
                success: function (data) {
                    if (data == "existed") {
                        $('#check-add-book-name').html("Book name existed,Pls try again")
                        checkBookName = false
                        return
                    } else {
                        $('#check-add-book-name').html("")
                        checkBookName = true
                        return;
                    }
                }
            })
        }
    }

    function checkCode() {
        let id = $('#add-book-id').val();
        let code = $('#add-book-code').val();
        if (code == "") {
            $('#check-add-book-code').html("Book code cannot blank")
            checkBookCode = false;
            return
        }else
        if (!code.match("^([a-zA-Z0-9.#$%&*+/-\\s]+)$")) {
            $('#check-add-book-code').html("Code without Vietnamese character")
            checkBookName = false;
            return;
        }else
        if (id) {
            $.ajax({
                async: false,
                url: "http://localhost:8080/books/" + id,
                type: 'GET',
                success: function (data) {
                    if (data.code == code) {
                        checkBookCode = true;
                        return
                    } else {
                        $.ajax({
                            async: false,
                            url: "http://localhost:8080/books/code/" + code,
                            type: 'GET',
                            success: function (data) {
                                if (data == "existed") {
                                    $('#check-add-book-code').html("Book code existed,Pls try again")
                                    checkBookCode = false;
                                    return
                                } else {
                                    $('#check-add-book-code').html("")
                                    checkBookCode = true;
                                    return;
                                }
                            }
                        })
                    }
                }
            })
        } else {
            $.ajax({
                async: false,
                url: "http://localhost:8080/books/code/" + code,
                type: 'GET',
                success: function (data) {
                    if (data == "existed") {
                        $('#check-add-book-code').html("Book code existed,Pls try again")
                        checkBookCode = false;
                        return
                    } else {
                        $('#check-add-book-code').html("")
                        checkBookCode = true;
                        return;
                    }
                }
            })
        }
    }

    function checkQuantity() {
        let id = $('#add-book-id').val();
        let inStock = $('#add-book-inStock').val();
        if (inStock==""){
            $('#check-add-book-inStock').html("Quantity cannot blank, if you have no book now, pls enter 0")
            checkBookInStock = false;
            return;
        }else
        if (inStock.match("^[0-9]+$")) {
            $('#check-add-book-inStock').html("")
            checkBookInStock = true;
            return;
        } else {
            $('#check-add-book-inStock').html("Quantity incorrect format")
            checkBookInStock = false;
            return;
        }
    }

    function checkAuthor() {
        let author = $('#add-book-author').val();
        if (author == "") {
            $('#check-add-book-author').html("Name author cannot blank")
            checkBookAuthor = false;
        } else if (!author.match("^([a-zA-Z'ỳọáầảấờễàạằệếýộậốũứĩõúữịỗìềểẩớặòùồợãụủíỹắẫựỉỏừỷởóéửỵẳẹèẽổẵẻỡơôưăêâđ\\s]+)$")) {
            $('#check-add-book-author').html("Author name without special character or number")
            checkBookAuthor = false
        } else {
            $('#check-add-book-author').html("")
            checkBookAuthor = true;
        }
    }

    function checkBookInput() {
        let id = $('#add-book-id').val();

        checkName();
        checkCode();
        checkQuantity();
        checkAuthor();
        console.log("data", checkBookAuthor, checkBookName, checkBookCode, checkBookInStock)
        if (checkBookInStock && checkBookName && checkBookCode && checkBookAuthor) {
            if (id) {
                $('#addBookModal').hide();
                $('#function-btn-book').attr("data-toggle", "modal");
                $('#function-btn-book').attr("data-target", "#editbookModal");
                getEditBookInfo();
            } else {
                $('#addBookModal').hide();
                $('#function-btn-book').attr("data-toggle", "modal");
                $('#function-btn-book').attr("data-target", "#showBookModal");
                getNewBookInfo();
            }
        } else {
            $('#function-btn-book').attr("data-toggle", "");
            $('#function-btn-book').attr("data-target", "");
            checkName();
            checkCode();
            checkQuantity();
            checkAuthor();
        }
    }

    // get book info
    function getNewBookInfo() {
        // console.log("new book")
        let name = $('#add-book-name').val();
        let categoryId = $('#add-book-category').val();
        let category;
        let author = $('#add-book-author').val();
        let code = $('#add-book-code').val();
        let inStock = $('#add-book-inStock').val();
        let str = "";

        str += '<table class="table">\n' +
            '    <tr>\n' +
            '        <td>Book code:</td>\n' +
            '        <td>'+ code + '</td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>Book Name</td>\n' +
            '        <td>'+ name +'</td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>Author:</td>\n' +
            '        <td>'+ author +'</td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>Category:</td>\n'
        let href = "http://localhost:8080/categories/" + categoryId;
        $.ajax({
            async: false,
            url: href,
            type: 'GET',
            success: function (data) {
                str+= '<td>'+data.category+'</td>\n'
            }})
           str+=
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>Quantity:</td>\n' +
            '        <td>' + inStock +'</td>\n' +
            '    </tr></table>';
        $('#add-book-show-modal').html(str)
    }

    // get edit book info
    function getEditBookInfo() {
        $('#viewBookModal').hide();
        let id = $('#add-book-id').val();
        id_action = id;
        let name = $('#add-book-name').val();
        let categoryId = $('#add-book-category').val();
        let author = $('#add-book-author').val();
        let code = $('#add-book-code').val();
        let inStock = $('#add-book-inStock').val();
        let str = "";

        str += '<table class="table">\n' +
            '    <tr>\n' +
            '        <td>Book code:</td>\n' +
            '        <td>'+ code + '</td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>Book Name</td>\n' +
            '        <td>'+ name +'</td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>Author:</td>\n' +
            '        <td>'+ author +'</td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>Category:</td>\n'
        let href = "http://localhost:8080/categories/" + categoryId;
        $.ajax({
            async: false,
            url: href,
            type: 'GET',
            success: function (data) {
                str+= '<td>'+data.category+'</td>\n'
            }})
        str+=
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>Quantity:</td>\n' +
            '        <td>' + inStock +'</td>\n' +
            '    </tr></table>';
        $('#edit-book-show-modal').html(str)
    }

    //get delet book info
    function getDeletebookInfo(id) {
        id_action = id;
        $.ajax({
            async: false,
            url: "http://localhost:8080/orders/book/" + id,
            type: 'GET',
            success: function (data) {
                console.log(data)
                if (data == "existed") {
                    $('#viewBookModal').hide();
                    $('#deletebookModalLabel').html("Action error")
                    $('#delete-book-show-modal').html("Book's in borrowing, can't delete")
                    $('#delete-book-cf-btn').hide();
                } else {
                    $('#delete-book-cf-btn').show();
                    // console.log("sach dang muon")
                    $.ajax({
                        async: false,
                        url: "http://localhost:8080/books/" + id,
                        type: 'GET',
                        success: function (book) {
                            console.log(book)
                            // console.log("lay ra duoc id hien tai k", id)
                            let name = book.name;
                            let code = book.code;
                            let categoryId = book.category.id;
                            let author = book.author;
                            let inStock = book.inStock;
                            let str = "";
                            // console.log("lay id xoa",id)
                            str += '<table class="table">\n' +
                                '    <tr>\n' +
                                '        <td>Book code:</td>\n' +
                                '        <td>' + code + '</td>\n' +
                                '    </tr>\n' +
                                '    <tr>\n' +
                                '        <td>Book Name</td>\n' +
                                '        <td>' + name + '</td>\n' +
                                '    </tr>\n' +
                                '    <tr>\n' +
                                '        <td>Author:</td>\n' +
                                '        <td>' + author + '</td>\n' +
                                '    </tr>\n' +
                                '    <tr>\n' +
                                '        <td>Category:</td>\n'
                            let href = "http://localhost:8080/categories/" + categoryId;
                            $.ajax({
                                async: false,
                                url: href,
                                type: 'GET',
                                success: function (data) {
                                    str += '<td>' + data.category + '</td>\n'
                                }
                            })
                            str +=
                                '    </tr>\n' +
                                '</table>';
                            $('#delete-book-show-modal').html(str)
                        }
                    })

                }
            }
        })
    }

    // show edit form
    function showEditForm(id) {
        $.ajax({
            async: false,
            url: "http://localhost:8080/orders/book/" + id,
            type: 'GET',
            success: function (data) {
                if (data == "existed") {
                    $('#viewBookModal').hide();
                    $('#confirmModalLabel').html("Action error")
                    $('#confirm-content').html("Book's in borrowing, can't edit")
                    $('#function-btn-book').attr("data-toggle", "modal");
                    $('#function-btn-book').attr("data-target", "#confirmModal");
                } else {
                    $('#add-book-name').attr("disabled", false);
                    $('#add-book-category').attr("disabled", false);
                    $('#add-book-author').attr("disabled", false);
                    $('#function-btn-book').html("Update");
                    $('#function-btn-book').attr("data-target", "#editbookModal");
                    $('#function-btn-book').attr("onclick", "checkBookInput()");
                }
            }
        })
    }

    // create new book
    function addNewBook() {
        let str ="";
        let name = $('#add-book-name').val();
        let categoryId = $('#add-book-category').val();
        let author = $('#add-book-author').val();
        let code = $('#add-book-code').val();
        let inStock = $('#add-book-inStock').val();
        let obj = {
            "name": name,
            "code": code,
            "author": author,
            "category": {
                "id": categoryId
            },
            "inStock": inStock,
        }
        // console.log("type",typeof(obj))
        let data = JSON.stringify(obj)
        // console.log("data tao tu obj",data)
        $.ajax({
            async: false,
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            url: "http://localhost:8080/books",
            type: 'POST',
            data: data,
            success: function (data) {
                str += '<p style="color: black">Add new book success</p>' + '<br>';
            },
            error: function (data) {
                console.log("error", data)
                str += '<p style="color: red">Add unsuccess because '+data.responseText+'! please check again</p>' + '<br>';
            }
        })
        $('#confirmModalLabel').html("Add new book confirm");
        $('#confirm-content').html(str);
    }

    // create new book
    function editBook() {
        let str = "";
        let id = id_action;
        let name = $('#add-book-name').val();
        let code = $('#add-book-code').val();
        let categoryId = $('#add-book-category').val();
        let author = $('#add-book-author').val();
        let inStock = $('#add-book-inStock').val();
        let obj = {
            "name": name,
            "code": code,
            "author": author,
            "category": {
                "id": categoryId
            },
            "inStock": inStock
        }
        // console.log("type",typeof(obj))
        let data = JSON.stringify(obj)
        // console.log("data tao tu obj",data)
        $.ajax({
            async: false,
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            url: "http://localhost:8080/books?id=" + id,
            type: 'PUT',
            data: data,
            success: function (data) {
                // console.log("sau khi update", data)
                str += '<p style="color: black">Update book success</p>' + '<br>';
            },
            error: function (data) {
                console.log("error", data)
                str += '<p style="color: red">Update unsuccess because '+data.responseText+'! please check again</p>' + '<br>';
            }
        })
        $('#confirmModalLabel').html("Update book confirm");
        $('#confirm-content').html(str);
    }

    // create new book
    function deletebook() {
        let id = id_action;
        // console.log("data tao tu obj",data)
        $.ajax({
            async: false,
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            url: "http://localhost:8080/books/" + id,
            type: 'PUT',
            success: function (data) {
                // console.log("sau khi update", data)
                $('#confirmModalLabel').html("Delete book confirm");
                $('#confirm-content').html("Delete success!");
            }, error: function (data){
                $('#confirmModalLabel').html("Delete book confirm");
                $('#confirm-content').html("Delete unsuccess because "+data.responseText+"! please check again");
            }
        })
    }
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js" type="text/javascript"></script>
<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="Stylesheet"
      type="text/css"/>
<script th:src="@{/webjars/jquery/jquery.min.js}"></script>
<script th:src="@{/webjars/popper.js/umd/popper.min.js}"></script>
<script th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"></script>

</body>
</html>