<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link th:rel="stylesheet" th:href="@{/webjars/bootstrap/4.0.0-2/css/bootstrap.min.css} "/>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
            integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!--    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">-->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!--    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>-->
    <!--    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/jquery.validate.js"></script>-->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
</head>
<body>
<th:block th:replace="share/header :: header"></th:block>
<div class="container" th:fragment="content">
    <div>
        <h1 style="text-align: center; margin: 0">Manage Book Information</h1>
    </div>
    <hr>
    <span style="color: red; margin-top:5px" id="validate"></span>
    <br>
    <br>
    <div id="book-content" >
        <table class="table table-striped">
            <form class="form-inline">
                <input class="form-control mr-sm-2" type="search" name="key" placeholder="Search by name or book code" aria-label="Search">
            </form>

            <thead>
            <th colspan="3">Book Information</th>
            <th>
                <button type="button" id="add-book" class="btn btn-success" >Add new book</button>
            </th>
            </thead>
            <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Code</th>
                <th scope="col">Name</th>
                <th scope="col">Author</th>
                <th scope="col">Category</th>
                            <th scope="col">Quantity</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each ="b, s : ${books}" th:onclick="'showDetail('+${b.id}+')'">
                <td th:utext="${s.index +1}"></td>
                <td th:utext="${b.code}"></td>
                <td th:utext="${b.name}"></td>
                <td th:utext="${b.author}"></td>
                <td th:utext="${b.category.category}"></td>
                <td th:utext="${b.inStock}"></td>
<!--                            <td><a class="btn btn-primary">Quick act</a></td>-->

                <!--            <td><a th:href="@{/books/findById/(id=${book.id})}" class="btn btn-danger" id="deleteButton">Delete</a></td>-->
            </tr>
            </tbody>
        </table>
        <div>
            <ul class="nav nav-pills">
                <li class="nav-item" th:each="i:${#numbers.sequence(0,books.totalPages-1)}">
                    <a th:href="@{'/books'(page=${i})}" th:text="${i+1}" class="nav-link" th:classappend="${books.number}==${i}?'active':''"></a>
                </li>
            </ul>
        </div>
    </div>
</div>
<!-- show Modal -->
<div class="modal fade" id="showBookModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="showBookModalLabel">Add new book confirm</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="color: red">
                <div id="add-book-show-modal"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <a type="button" data-toggle="modal" data-target="#confirmModal" onclick="addNewBook()" data-dismiss="modal" class="btn btn-primary" >Confirm</a>
            </div>
        </div>
    </div>
</div>

<!-- show edit Modal -->
<div class="modal fade" id="editbookModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editbookModalLabel">Update book confirm</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="color: red">
                <div id="edit-book-show-modal"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <a type="button" data-toggle="modal" data-target="#confirmModal" onclick="editBook()" data-dismiss="modal" class="btn btn-primary" >Confirm</a>
            </div>
        </div>
    </div>
</div>

<!-- show delete Modal -->
<div class="modal fade" id="deletebookModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deletebookModalLabel">Delete book confirm</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="color: red">
                <div id="delete-book-show-modal"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <a type="button" data-toggle="modal" data-target="#confirmModal" onclick="deletebook()" data-dismiss="modal" class="btn btn-primary" >Confirm</a>
            </div>
        </div>
    </div>
</div>

<!-- confirm Modal -->
<div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmModalLabel">Add new book confirm</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div id="confirm-content" class="modal-body" style="color: red">
                Add new success!
            </div>
            <div class="modal-footer">
                <button type="button" onclick="reload()" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <!--                <a type="button" class="btn btn-primary" data-dismiss="modal">Confirm</a>-->
            </div>
        </div>
    </div>
</div>



<th:block th:replace="share/footer :: footer"></th:block>


<script th:inline="javascript">
    let checkBookCode;
    let checkBookName;
    function reload(){
        window.location.reload();
    }
    $(document).ready(function (){
        //show form add book
        $('#add-book').on('click',function (event){
            // event.preventDefault();
            let str = '<div class=login d-flex align-items-center py-5>\n '+
                ' <div class=container>\n' +
                '   <div class="row">\n' +
                '    <div class="col-md-9 col-lg-8 mx-auto pl-5 pr-5">\n' +
                '       <h3 class="login-heading mb-4">Add new book</h3>\n'+
                '<i style="color: black">Pls fill the form, have <i style="color: red">* </i>is required</i>'+
                '       <form id="form" method="post">\n' +
                '         <div class="form-label-group">\n' +
                '            <label for="add-book-code" class="text-secondary">Book code<i style="color: red">* </i></label>\n' +
                '<small style="color: red" id="check-add-book-code"></small>'+
                '           <input oninput="checkCode()" type="text" name="add-book-code" id="add-book-code" required class="form-control" >\n' +
                '          </div>\n' +
                '         <div class="form-label-group">\n' +
                '            <label for="add-book-name" class="text-secondary">Book name<i style="color: red">* </i></label>\n' +
                '<small style="color: red" id="check-add-book-name"></small>'+
                '           <input oninput="checkName()" type="text" name="add-book-name" id="add-book-name" required class="form-control" >\n' +
                '          </div>\n' +
                '         <div class="form-label-group">\n' +
                '            <label for="add-book-author" class="text-secondary">Book Author<i style="color: red">* </i></label>\n' +
                '<small style="color: red" id="check-add-book-author"></small>'+
                '           <input type="text" name="add-book-author" id="add-book-author" required class="form-control" >\n' +
                '          </div>\n' +
                '          <div class="form-label-group mb-4">\n '+
                '           <span class="text-secondary">Category<i style="color: red">* </i></span> <br><br><br>\n'+
                '<select id="add-book-category" class="form-control">';
            var link = 'http://localhost:8080/categories';
            $.get(link,function (category, status){
                let categories = category.slice();
                let html;
                $.each(categories, function (index, items){
                    // console.log("items laa ra", items.id)
                    html +='<option value="'+items.id+'">'+items.category+'</option>'
                })
                $('#add-book-category').append(html);
            })
            str +=  ' </select>'+
                '         <div class="form-label-group">\n' +
                '            <label for="add-book-inStock" class="text-secondary">Quantity</label>\n' +
                '<small style="color: red" id="check-add-book-inStock"></small>'+
                '           <input type="text" name="add-book-inStock" id="add-book-inStock" required class="form-control" >\n' +
                '          </div>\n' +
                '<br><br>'+
                '         <a data-toggle="modal" id="function-btn-book" data-target="#showBookModal" onclick="checkBookInput()" class="btn btn-lg btn-outline-primary btn-block btn-login text-uppercase font-weight-bold mb-2">Add new</a>\n' +
                '         <a onclick="reload()" class="btn btn-lg btn-outline-primary btn-block btn-login text-uppercase font-weight-bold mb-2">Back</a>\n' +
                '       </form>\n' +
                '     </div>\n' +
                '   </div>\n' +
                '  </div>\n' +
                '</div>'
            $('#book-content').html(str);
        })
    })

    function checkName(){
        let name = $('#add-book-name').val();
        let id = $('#add-book-id').val();
        let href = "http://localhost:8080/books/name/"+name
            if (id){
                $.ajax({
                    async: false,
                    url: "http://localhost:8080/books/"+id,
                    type: 'GET',
                    success: function (data) {
                        if (data.name==name){
                            checkBookName = true;
                        }else {
                            $.ajax({
                                async: false,
                                url: href,
                                type: 'GET',
                                success: function (data) {
                                    if (data=="existed"){
                                        checkBookName = false
                                        $('#check-add-book-name').html("Book name existed,Pls try again")
                                    }
                                    else {
                                        $('#check-add-book-name').html("")
                                        checkBookName = true
                                    }
                                }
                            })
                        }
                    }
                })
            }else {
                $.ajax({
                    async: false,
                    url: href,
                    type: 'GET',
                    success: function (data) {
                        if (data=="existed"){
                            checkBookName = false
                            $('#check-add-book-name').html("Book name existed,Pls try again")
                        }
                        else {
                            $('#check-add-book-name').html("")
                            checkBookName = true
                        }
                    }
                })
            }
    }
    function checkCode(){
        let id = $('#add-book-id').val();
        let code = $('#add-book-code').val();
        let href = "http://localhost:8080/books/code/"+code;
        if (id){
            $.ajax({
                async: false,
                url: "http://localhost:8080/books/"+id,
                type: 'GET',
                success: function (data) {
                    if (data.code==code){
                        checkBookCode = true;
                    }else {
                        $.ajax({
                            async: false,
                            url: href,
                            type: 'GET',
                            success: function (data) {
                                if (data=="existed"){
                                    checkBookCode = false
                                    $('#check-add-book-code').html("Book code existed,Pls try again")
                                }
                                else {
                                    $('#check-add-book-code').html("")
                                    checkBookCode = true
                                }
                            }
                        })
                    }
                }
            })
        }else {
            $.ajax({
                async: false,
                url: href,
                type: 'GET',
                success: function (data) {
                    if (data=="existed"){
                        checkBookCode = false
                        $('#check-add-book-code').html("Book code existed,Pls try again")
                    }
                    else {
                        $('#check-add-book-code').html("")
                        checkBookCode = true
                    }
                }
            })
        }
    }

    function checkBookInput(){
        let id = $('#add-book-id').val()
        let code = $('#add-book-code').val();
        let name = $('#add-book-name').val();
        let author = $('#add-book-author').val();
        checkName();
        checkCode();
        // console.log("check name "+ checkBookName + "check code "+ checkBookCode)
        if (name==""||name==null){
            $('#check-add-book-name').html("Name cannot blank");
            $('#function-btn-book').attr("data-target","");
            $('#function-btn-book').attr("data-toggle","");
        }else {
            // console.log("check name", checkBookName)
            if (checkBookName&&checkBookCode&&author){
                $('#check-add-book-name').html("");
                if (id){
                    $('#function-btn-book').attr("data-toggle","modal");
                    $('#function-btn-book').attr("data-target","#editbookModal");
                    getEditBookInfo();
                }else {
                    $('#function-btn-book').attr("data-toggle","modal");
                    $('#function-btn-book').attr("data-target","#showBookModal");
                    getNewBookInfo();
                }
            }else {
               checkName()
                $('#function-btn-book').attr("data-target","");
                $('#function-btn-book').attr("data-toggle","");
            }
            
        }
        if (author==""||author==null){
            $('#check-add-book-author').html("Book author cannot blank");
            $('#function-btn-book').attr("data-target","");
            $('#function-btn-book').attr("data-toggle","");
        }else {
            if (checkBookCode&&checkBookName) {
                $('#check-add-book-author').html("");
                if (id) {
                    $('#function-btn-book').attr("data-toggle", "modal");
                    $('#function-btn-book').attr("data-target", "#editbookModal");
                    getEditBookInfo();
                } else {
                    $('#function-btn-book').attr("data-toggle", "modal");
                    $('#function-btn-book').attr("data-target", "#showBookModal");
                    getNewBookInfo();
                }
            }
        }
        if (code==""||code==null){
            $('#check-add-book-code').html("code cannot blank");
            $('#function-btn-book').attr("data-target","");
            $('#function-btn-book').attr("data-toggle","");
        }else {
            if (checkBookCode&&checkBookName&&author){
                $('#check-add-book-code').html("");
                if (id){
                    $('#function-btn-book').attr("data-toggle","modal");
                    $('#function-btn-book').attr("data-target","#editbookModal");
                    getEditBookInfo();
                }else {
                    // console.log("name lay ra", name)
                    $('#function-btn-book').attr("data-toggle","modal");
                    $('#function-btn-book').attr("data-target","#showBookModal");
                    getNewBookInfo();
                }
            }else {
                checkCode();
                $('#function-btn-book').attr("data-target","");
                $('#function-btn-book').attr("data-toggle","");
            }
        }
    }


    // show detail book form
    function showDetail(id){
        $.ajax({
            async: false,
            url: 'http://localhost:8080/books/'+id,
            method: 'GET',
            dataType: 'json',
            success: function (data) {
                // console.log(data)
                let str = "";
                str +=
                    '  <div class="container">\n' +
                    '    <div class="row">\n' +
                    '      <div class="col-md-9 col-lg-8 mx-auto pl-5 pr-5">\n' +
                    '            <input type="text" disabled value="'+data.id+'" hidden id="add-book-id" class="form-control" >\n' +
                    '<div class="row no-gutters">\n' +
                    '  <div class="col-12 col-sm-6 col-md-10"><h3 class="login-heading mb-4">Book Information</h3></div>\n' +
                    '  <div class="col-6 col-md-2"><a type="button" class="btn btn-primary" style="margin-inline-end: auto; text-align: right" data-toggle="" data-target="" id="showEdit" onclick="showEditForm()">Edit</a></div>\n' +
                    '</div>'+
                    '        <form>\n' +
                    '          <div class="form-label-group">\n' +
                    '            <label class="text-secondary">Book code</label>\n' +
                    '<small style="color: red" id="check-add-book-code"></small>'+
                    '            <input type="text" oninput="checkCode()" disabled value="'+data.code+'" id="add-book-code" class="form-control" >\n' +
                    '          </div>\n' +
                    '          <div class="form-label-group">\n' +
                    '            <label class="text-secondary">Book name</label>\n' +
                    '<small style="color: red" id="check-add-book-name"></small>'+
                    '            <input type="text" oninput="checkName()" disabled value="'+data.name+'" id="add-book-name" class="form-control" >\n' +
                    '          </div>\n' +
                    '          <div class="form-label-group mb-4 md-form md-outline input-with-post-icon datepicker">\n' +
                    '            <label class="text-secondary">Author</label>\n' +
                    '<small style="color: red" id="check-add-book-author"></small>'+
                    '            <input disabled type="text" id="add-book-author" value="'+data.author+'" class="form-control">\n' +
                    '          </div>\n' +
                    '          <div class="form-label-group mb-4">\n '+
                    '           <label class="text-secondary">Category</label> <br><br><br>\n'+
                    '<select disabled id="add-book-category" class="form-control">';
                var link = 'http://localhost:8080/categories';
                $.get(link,function (category, status){
                    let categoryList = category.slice();
                    let html = "";
                    $.each(categoryList, function (index, items){
                        // console.log("items laa ra", items.id)
                        if (items.category == data.category.category){
                            html +='<option selected value="'+items.id+'">'+items.category+'</option>'
                        }else {
                            html +='<option value="'+items.id+'">'+items.category+'</option>'
                        }
                    })
                    $('#add-book-category').append(html);
                })
                str +=  ' </select>'+
                    '       </div>\n' +
                    '          <div class="form-label-group mb-4">\n' +
                    '         </div>\n' +
                    '          <div class="form-label-group mb-4 md-form md-outline input-with-post-icon datepicker">\n' +
                    '            <label class="text-secondary">Quantity</label>\n' +
                    '<small style="color: red" id="check-add-book-inStock"></small>'+
                    '            <input disabled type="text" id="add-book-inStock" value="'+data.inStock+'" class="form-control">\n' +
                    '          </div>\n' +
                    '         <a data-toggle="modal" id="function-btn-book" onclick="getDeletebookInfo()" data-target="#deletebookModal" class="btn btn-lg btn-outline-primary btn-block btn-login text-uppercase font-weight-bold mb-2">Delete</a>\n' +
                    '        <a onclick="reload()" class="btn btn-lg btn-outline-primary btn-block btn-login text-uppercase font-weight-bold mb-2">Back</a>\n' +
                    '       </form>\n' +
                    '      </div>\n' +
                    '    </div>\n' +
                    '</div>';
                $('#book-content').html(str);
            }
        })
    }

    // get book info
    function getNewBookInfo(){
        // console.log("new book")
        let name = $('#add-book-name').val();
        let categoryId = $('#add-book-category').val();
        let category;
        let author = $('#add-book-author').val();
        let code = $('#add-book-code').val();
        let inStock = $('#add-book-inStock').val();
        let str = "";

        str += "<div class=\"form-group\">\n" +
            "                        <label class=\"col-form-label\">Book code:</label>\n" +
            "                        <input type='text' disabled value='"+code+"' >\n" +
            "                    </div>"+
            "<div class=\"form-group\">\n" +
            "                        <label class=\"col-form-label\">Name:</label>\n" +
            "                        <input type='text' disabled value='"+name+"' >\n" +
            "                    </div>"+
            "<div class=\"form-group\">\n" +
            "                        <label class=\"col-form-label\">Author:</label>\n" +
            "                        <input type='text' disabled value='"+author+"' >\n" +
            "                    </div>"+
            "<div class=\"form-group\">\n" +
            "                        <label id='category' class=\"col-form-label\">Category:</label>\n"+
            "<input id='categoryShow' type='text' disabled value='' >"
        let href = "http://localhost:8080/categories/"+categoryId;
        $.get(href,function (data,status){
            // console.log("data",data)
            category = data.category;
            // console.log("lay ra category", category)
            $('#categoryShow').val(category);
        })
        str +=
            "                    </div>"+
            "<div class=\"form-group\">\n" +
            "                        <label class=\"col-form-label\">Quantity:</label>\n" +
            "                        <input type='text' disabled value='"+inStock+"' >\n" +
            "                    </div>";
        $('#add-book-show-modal').html(str)
    }
    // get edit book info
    function getEditBookInfo(){
        let name = $('#add-book-name').val();
        let categoryId = $('#add-book-category').val();
        let author = $('#add-book-author').val();
        let code = $('#add-book-code').val();
        let inStock = $('#add-book-inStock').val();
        let str = "";

        str += "<div class=\"form-group\">\n" +
            "                        <label class=\"col-form-label\">Book code:</label>\n" +
            "                        <input type='text' disabled value='"+code+"' >\n" +
            "                    </div>"+
            "<div class=\"form-group\">\n" +
            "                        <label class=\"col-form-label\">Name:</label>\n" +
            "                        <input type='text' disabled value='"+name+"' >\n" +
            "                    </div>"+
            "<div class=\"form-group\">\n" +
            "                        <label class=\"col-form-label\">Author:</label>\n" +
            "                        <input type='text' disabled value='"+author+"' >\n" +
            "                    </div>"+
            "<div class=\"form-group\">\n" +
            "                        <label id='category' class=\"col-form-label\">Category:</label>\n"+
            "<input id='categoryShow' type='text' disabled value='' >"
        let href = "http://localhost:8080/categories/"+categoryId;
        $.get(href,function (data,status){
            // console.log("data",data)
            category = data.category;
            // console.log("lay ra category", category)
            $('#categoryShow').val(category);
        })
        str +=
            "                    </div>"+
            "<div class=\"form-group\">\n" +
            "                        <label class=\"col-form-label\">Quantity:</label>\n" +
            "                        <input type='text' disabled value='"+inStock+"' >\n" +
            "                    </div>";
        $('#edit-book-show-modal').html(str)
    }
    //get delet book info
    function getDeletebookInfo(){
        let id = $('#add-book-id').val();
        $.ajax({
            async: false,
            url:"http://localhost:8080/orders/book/" +id,
            type: 'GET',
            success: function (data) {
               if (data=="existed"){
                   $('#function-btn-book').attr("data-target","#confirmModal");
                   $('#function-btn-book').attr("data-toggle","modal");
                   $('#confirmModalLabel').html("Action error")
                   $('#confirm-content').html("Book's in borrowing, can't delete")
               }else {
                   // console.log("lay ra duoc id hien tai k", id)
                   let name = $('#add-book-name').val();
                   let code = $('#add-book-code').val();
                   let categoryId = $('#add-book-category').val();
                   let author = $('#add-book-author').val();
                   let inStock = $('#add-book-inStock').val();
                   let str = "";
                   // console.log("lay id xoa",id)
                   str +=
                       "<div class=\"form-group\">\n" +
                       "                        <label class=\"col-form-label\">ID:</label>\n" +
                       "                        <input type='text' disabled value='"+code+"' >\n" +
                       "                    </div>"+
                       "<div class=\"form-group\">\n" +
                       "                        <label class=\"col-form-label\">Name:</label>\n" +
                       "                        <input type='text' disabled value='"+name+"' >\n" +
                       "                    </div>"+
                       "<div class=\"form-group\">\n" +
                       "                        <label class=\"col-form-label\">Gender:</label>\n" +
                       "                        <input type='text' disabled value='"+author+"' >\n" +
                       "                    </div>"+
                       "<div class=\"form-group\">\n" +
                       "                        <label id='category' class=\"col-form-label\">category:</label>\n"
                   let href = "http://localhost:8080/categories/"+categoryId;
                   $.get(href,function (data,status){
                       // console.log("data",data)
                       category = data.category;
                       let html = "<input type='text' disabled value='"+category+"' >"
                       // console.log("lay ra category", category)
                       $('#category').append(html);
                   })
                   str +=
                       "                    </div>"+
                       "<div class=\"form-group\">\n" +
                       "                        <label class=\"col-form-label\">Quantity:</label>\n" +
                       "                        <input type='text' disabled value='"+inStock+"' >\n" +
                       "                    </div>";
                   $('#delete-book-show-modal').html(str)

               }
            }
        })
    }

    // show edit form
    function showEditForm() {
        let id = $('#add-book-id').val();
        $.ajax({
            async: false,
            url: "http://localhost:8080/orders/book/" + id,
            type: 'GET',
            success: function (data) {
                if (data == "existed") {
                    $('#confirmModalLabel').html("Action error")
                    $('#confirm-content').html("Book's in borrowing, can't edit")
                    $('#showEdit').attr("data-toggle","modal");
                    $('#showEdit').attr("data-target","#confirmModal");
                } else {
                    $('#add-book-name').attr("disabled", false);
                    $('#add-book-code').attr("disabled", false);
                    $('#add-book-category').attr("disabled", false);
                    $('#add-book-author').attr("disabled", false);
                    $('#function-btn-book').html("Update");
                    $('#function-btn-book').attr("data-target", "#editbookModal");
                    $('#function-btn-book').attr("onclick", "checkBookInput()");
                }
            }
        })
    }


    // create new book
    function addNewBook(){
        let name = $('#add-book-name').val();
        let categoryId = $('#add-book-category').val();
        let author = $('#add-book-author').val();
        let code = $('#add-book-code').val();
        let inStock = $('#add-book-inStock').val();
        let obj = {
            "name": name,
            "code": code,
            "author":author,
            "category": {
                "id": categoryId
            },
            "inStock":inStock,
        }
        // console.log("type",typeof(obj))
        let data = JSON.stringify(obj)
        // console.log("data tao tu obj",data)
        $.ajax({
            async: false,
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            url: "http://localhost:8080/books",
            type: 'POST',
            data: data,
            success: function (data) { console.log("data tao tu obj",data)
            }
        })
    }
    // create new book
    function editBook(){
        let id = $('#add-book-id').val();
        let name = $('#add-book-name').val();
        let code = $('#add-book-code').val();
        let categoryId = $('#add-book-category').val();
        let author = $('#add-book-author').val();
        let obj = {
            "id": id,
            "name": name,
            "code": code,
            "author":author,
            "category": {
                "id": categoryId
            }
        }
        // console.log("type",typeof(obj))
        let data = JSON.stringify(obj)
        // console.log("data tao tu obj",data)
        $.ajax({
            async: false,
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            url: "http://localhost:8080/books",
            type: 'PUT',
            data: data,
            success: function (data) {
                console.log("sau khi update", data)
                $('#confirmModalLabel').html("Update book confirm");
                $('#confirm-content').html("Update success!");
            }
        })
    }
    // create new book
    function deletebook(){
        let id = $('#add-book-id').val();
        // console.log("data tao tu obj",data)
        $.ajax({
            async: false,
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            url: "http://localhost:8080/books/"+id,
            type: 'PUT',
            success: function (data) {
                // console.log("sau khi update", data)
                $('#confirmModalLabel').html("Delete book confirm");
                $('#confirm-content').html("Delete success!");
            }
        })
    }
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js" type="text/javascript"></script>
<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="Stylesheet" type="text/css" />
<script th:src="@{/webjars/jquery/jquery.min.js}"></script>
<script th:src="@{/webjars/popper.js/umd/popper.min.js}"></script>
<script th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"></script>

</body>
</html>